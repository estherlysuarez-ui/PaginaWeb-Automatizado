<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Cinta Transportadora Profesional VR/AR</title>
  <meta name="description" content="Simulación mecatrónica VR/AR">
  <script src="https://aframe.io/releases/1.4.1/aframe.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    #buttons {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 999;
      display: flex;
      flex-direction: column;
    }
    button {
      margin: 5px;
      padding: 10px 15px;
      border-radius: 5px;
      border: none;
      color: white;
      font-size: 14px;
      cursor: pointer;
      background: #444;
    }
    #arButton { background:#0077cc; }
  </style>
</head>
<body>
<div id="buttons">
  <button id="vrButton">VR</button>
  <button id="arButton">AR</button>
</div>

<a-scene background="color: #CFFCF8" embedded arjs="sourceType: webcam; debugUIEnabled: false">

  <!-- Cámara lateral izquierda-->
  <a-entity id="rig" position="10 3 0" rotation="0 90 0">
  <a-entity camera look-controls></a-entity>
  </a-entity>


  <!-- Piso -->
  <a-plane position="0 0 0" rotation="-90 0 0" width="50" height="50" color="#C8E0E4" shadow></a-plane>

  <!-- Estructura de la cinta -->
  <a-box position="0 0.9 0" width="4.2" height="0.2" depth="12" color="#222222" shadow></a-box> <!-- Base -->
  <a-box id="belt" position="0 1.1 0" width="4" height="0.2" depth="12" color="#333333" shadow material="src: https://i.imgur.com/Fkx3dXG.png; repeat: 6 1"></a-box> <!-- Banda -->

  <!-- Rodillos -->
  <a-cylinder position="0 1 6" radius="0.3" height="4" rotation="0 0 90" color="#555555" shadow></a-cylinder>
  <a-cylinder position="0 1 -6" radius="0.3" height="4" rotation="0 0 90" color="#555555" shadow></a-cylinder>

  <!-- Patas y soporte -->
  <a-box position="-1.9 0.45 5" width="0.2" height="0.9" depth="0.2" color="#666666" shadow></a-box>
  <a-box position="1.9 0.45 5" width="0.2" height="0.9" depth="0.2" color="#666666" shadow></a-box>
  <a-box position="-1.9 0.45 -5" width="0.2" height="0.9" depth="0.2" color="#666666" shadow></a-box>
  <a-box position="1.9 0.45 -5" width="0.2" height="0.9" depth="0.2" color="#666666" shadow></a-box>
  <a-box position="0 0.45 6" width="4.2" height="0.2" depth="0.2" color="#666666" shadow></a-box>
  <a-box position="0 0.45 -6" width="4.2" height="0.2" depth="0.2" color="#666666" shadow></a-box>

  <!-- Luces -->
  <a-entity light="type: ambient; intensity: 0.5"></a-entity>
  <a-entity light="type: directional; intensity: 0.8; castShadow: true" position="10 10 10"></a-entity>

  <!-- Animación automática -->
  <a-entity id="animator"></a-entity>

  <script>
    AFRAME.registerComponent('move-belt', {
      schema: {speed: {type: 'number', default: 0.01}}, // velocidad reducida
      init: function () {
        // Generar objetos aleatorios sobre la cinta
        this.objects = [];
        const types = ['box','sphere','cone'];
        for(let i=0;i<10;i++){
          const type = types[Math.floor(Math.random()*types.length)];
          const x = (Math.random()*3)-1.5;
          const z = -6 + Math.random()*12;
          const y = 1.3;
          let el;
          if(type==='box'){
            el = document.createElement('a-box');
            el.setAttribute('depth',1);
            el.setAttribute('width',1);
            el.setAttribute('height',1);
            el.setAttribute('color','#FF6347');
          } else if(type==='sphere'){
            el = document.createElement('a-sphere');
            el.setAttribute('radius',0.5);
            el.setAttribute('color','#FFD700');
          } else if(type==='cone'){
            el = document.createElement('a-cone');
            el.setAttribute('radius-bottom',0.5);
            el.setAttribute('radius-top',0);
            el.setAttribute('height',1);
            el.setAttribute('color','#00CED1');
          }
          el.setAttribute('position',{x:x,y:y,z:z});
          el.setAttribute('shadow','cast:true;receive:false');
          document.querySelector('a-scene').appendChild(el);
          this.objects.push(el);
        }
        this.belt = document.querySelector('#belt');
      },
      tick: function(time, timeDelta) {
        // Animar objetos
        this.objects.forEach(obj=>{
          let pos = obj.getAttribute('position');
          pos.z += this.data.speed * (timeDelta/16);
          if(pos.z > 6) pos.z = -6;
          obj.setAttribute('position', pos);
        });

        // Animar banda
        const beltMat = this.belt.getAttribute('material');
        beltMat.offset = beltMat.offset || {x:0, y:0};
        beltMat.offset.y -= this.data.speed;
        this.belt.setAttribute('material', beltMat);
      }
    });

    // Aplicar animación automáticamente al iniciar
    document.querySelector('a-scene').setAttribute('move-belt','speed:0.01');

    // Botones VR/AR
    document.getElementById('vrButton').addEventListener('click', ()=>{
      document.querySelector('a-scene').enterVR();
    });
    document.getElementById('arButton').addEventListener('click', ()=>{
      document.querySelector('a-scene').enterAR();
    });
  </script>
</a-scene>
</body>
</html>
